#!/usr/bin/env python2.7
# -*- coding: utf-8 -*-

'''
Faraday Penetration Test IDE
Copyright (C) 2016  Infobyte LLC (http://www.infobytesec.com/)
See the file 'doc/LICENSE' for the license information
'''

import os
import imp
import sys
import argparse

parent_path = os.path.abspath(os.path.join(__file__, '../..'))
sys.path.insert(0, parent_path)

from config.configuration import getInstanceConfiguration
CONF = getInstanceConfiguration()
WORKSPACE = CONF.getLastWorkspace()

if __name__ == '__main__':
    
    description = (
        'Using our plugin you can do different actions in the command line'
        ' and interact with Faraday. Faraday comes with some presets for bulk'
        ' actions such as object removal, get object information, etc.')

    parser = argparse.ArgumentParser(description=description)

    parser.add_argument(
        '-e',
        '--execute',
        help='Execute code received in this parameter.'
        ' Example:\n./fplugin -e "for h in get_hosts("WORKSPACE_NAME"): print h.name"')

    parser.add_argument(
        '-f',
        '--file',
        help='Script file.'
        ' Example:\n./fplugin -f getAllIps.py ')

    args, unknown = parser.parse_known_args()

    if args.execute:
        # [Shrug Here]
        exec(args.execute, globals(), locals())

    if args.file:

        # Get filename and import this
        module_fplugin = imp.load_source('module_fplugin', args.file)

        try:
            call_main = getattr(module_fplugin, 'main')
            call_main(workspace = WORKSPACE )
        except AttributeError:
            print 'Error: main() function missing in script?'
